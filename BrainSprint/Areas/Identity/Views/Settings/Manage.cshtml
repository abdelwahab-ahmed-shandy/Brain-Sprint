@model Models.ViewModels.SettingsVM

@{
    ViewData["Title"] = "Account Settings";
}

<div class="row justify-content-center">
    <div class="col-lg-14 col-xl-14">
        <div class="auth-card shadow-lg">
            <!-- Header Section with User Profile -->
            <div class="auth-header text-center mb-4">
                <div class="profile-header-image mx-auto position-relative">
                    <img src="@(Model.Profile.ProfileImage ?? "/Assets/Identity/images/UserPhoto/logo.png")"
                         alt="User Profile"
                         class="rounded-circle profile-main-image"
                         width="120" height="120">
                    @* <button class="btn btn-sm btn-accent rounded-circle position-absolute bottom-0 end-0 p-1" *@
                    @*         data-bs-toggle="tooltip" data-bs-title="Change profile picture" *@
                    @*         onclick="document.getElementById('profileImageInput').click()"> *@
                    @*     <i class="bi bi-camera-fill"></i> *@
                    @* </button> *@
                </div>
                <h2 class="fw-bold text-white mt-3 mb-1">@Model.Profile.FullName</h2>
                <div class="d-flex justify-content-center align-items-center gap-2">
                    <span class="badge bg-accent">
                        <i class="bi bi-star-fill me-1"></i> Level @Model.Profile.Level
                    </span>
                    <span class="badge bg-primary">
                        <i class="bi bi-coin me-1"></i> @Model.Profile.TotalPoints pts
                    </span>
                </div>

            <!-- Notification Messages -->
            <div class="notifications-container">
                @if (TempData["Success"] != null)
                {
                    <div class="alert alert-success alert-dismissible fade show">
                        <i class="bi bi-check-circle-fill me-2"></i> @TempData["Success"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }
                @if (TempData["Error"] != null)
                {
                    <div class="alert alert-danger alert-dismissible fade show">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i> @TempData["Error"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }
            </div>

            <!-- Main Navigation Tabs -->
            <ul class="nav nav-tabs nav-justified mb-4" id="settingsTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab">
                        <i class="bi bi-person-circle me-2"></i>Profile
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="manage-tab" data-bs-toggle="tab" data-bs-target="#manage" type="button" role="tab">
                        <i class="bi bi-gear me-2"></i>Settings
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security" type="button" role="tab">
                        <i class="bi bi-shield-lock me-2"></i>Security
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="delete-tab" data-bs-toggle="tab" data-bs-target="#delete" type="button" role="tab">
                        <i class="bi bi-trash me-2"></i>Delete
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="settingsTabsContent">
                <!-- Profile Tab -->
                <div class="tab-pane fade show active" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                    <div class="profile-info-container bg-dark rounded p-4 mb-4">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-item mb-3">
                                    <h6 class="text-muted"><i class="bi bi-person me-2"></i>First Name</h6>
                                    <p class="text-white">@Model.Profile.FirstName</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-item mb-3">
                                    <h6 class="text-muted"><i class="bi bi-person me-2"></i>Last Name</h6>
                                    <p class="text-white">@Model.Profile.LastName</p>
                                </div>
                            </div>
                        </div>

                        <div class="info-item mb-3">
                            <h6 class="text-muted"><i class="bi bi-envelope me-2"></i>Email</h6>
                            <p class="text-white">
                                @Model.Profile.Email
                                @if (Model.Profile.EmailVerified)
                                {
                                    <span class="badge bg-success ms-2"><i class="bi bi-check-circle me-1"></i>Verified</span>
                                }
                                else
                                {
                                    <span class="badge bg-warning ms-2"><i class="bi bi-exclamation-triangle me-1"></i>Not Verified</span>
                                }
                            </p>
                        </div>

                        <div class="info-item mb-3">
                            <h6 class="text-muted"><i class="bi bi-telephone me-2"></i>Phone Number</h6>
                            <p class="text-white">
                                @(Model.Profile.PhoneNumber ?? "Not provided")
                                @if (Model.Profile.PhoneNumberConfirmed)
                                {
                                    <span class="badge bg-success ms-2"><i class="bi bi-check-circle me-1"></i>Verified</span>
                                }
                            </p>
                        </div>

                        <div class="info-item mb-3">
                            <h6 class="text-muted"><i class="bi bi-info-circle me-2"></i>Bio</h6>
                            <p class="text-white">@(Model.Profile.Bio ?? "No bio yet")</p>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-item mb-3">
                                    <h6 class="text-muted"><i class="bi bi-calendar-plus me-2"></i>Registration Date</h6>
                                    <p class="text-white">@Model.Profile.RegistrationDate.ToString("dd MMMM yyyy")</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-item mb-3">
                                    <h6 class="text-muted"><i class="bi bi-clock-history me-2"></i>Last Login</h6>
                                    <p class="text-white">@(Model.Profile.LastLogin?.ToString("dd MMMM yyyy HH:mm") ?? "Never")</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end">
                            <button class="btn btn-outline-accent" id="settingsTabs" role="tablist" data-bs-toggle="tab" data-bs-target="#manage" type="button">
                            <i class="bi bi-pencil-square me-2"></i>Edit Profile
                        </button>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-pane fade" id="manage" role="tabpanel" aria-labelledby="manage-tab">
                        <form asp-controller="Settings" asp-action="UpdateProfile" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                        @Html.AntiForgeryToken()

                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-4 text-center">
                                        <img src="@(Model.Profile.ProfileImage ?? "/Assets/Identity/images/UserPhoto/logo.png")"
                                         id="profileImagePreview"
                                         class="rounded-circle mb-3 shadow"
                                         width="150" height="150">
                                    <input type="file" asp-for="Profile.ImageFile" class="form-control d-none" id="profileImageInput" accept=".jpg,.jpeg,.png">
                                    <button type="button" class="btn btn-sm btn-outline-accent" onclick="document.getElementById('profileImageInput').click()">
                                        <i class="bi bi-camera-fill me-1"></i> Change Photo
                                    </button>
                                    <div class="text-muted small mt-2">JPG, PNG up to 2MB</div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="form-floating mb-3">
                                    <input asp-for="Profile.FirstName" class="form-control" placeholder=" " />
                                    <label asp-for="Profile.FirstName">First Name</label>
                                    <span asp-validation-for="Profile.FirstName" class="text-danger small"></span>
                                </div>

                                <div class="form-floating mb-3">
                                    <input asp-for="Profile.LastName" class="form-control" placeholder=" " />
                                    <label asp-for="Profile.LastName">Last Name</label>
                                    <span asp-validation-for="Profile.LastName" class="text-danger small"></span>
                                </div>

                                <div class="form-floating mb-3">
                                    <textarea asp-for="Profile.Bio" class="form-control" placeholder=" " style="height: 100px"></textarea>
                                    <label asp-for="Profile.Bio">Bio</label>
                                    <span asp-validation-for="Profile.Bio" class="text-danger small"></span>
                                </div>

                                <div class="form-floating mb-3">
                                    <input asp-for="Profile.PhoneNumber" class="form-control" placeholder=" " />
                                    <label asp-for="Profile.PhoneNumber">Phone Number</label>
                                    <span asp-validation-for="Profile.PhoneNumber" class="text-danger small"></span>
                                </div>

                                <div class="d-flex justify-content-between align-items-center mt-4">
                                    <button type="reset" class="btn btn-outline-secondary">
                                        <i class="bi bi-arrow-counterclockwise me-2"></i>Reset
                                    </button>
                                    <button type="submit" class="btn btn-accent px-4">
                                        <span class="submit-text">
                                            <i class="bi bi-save me-2"></i>Save Changes
                                        </span>
                                        <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                    <!-- Security Tab -->
                    <div class="tab-pane fade" id="security" role="tabpanel" aria-labelledby="security-tab">
                        <div class="accordion" id="securityAccordion">

                            <!-- Password Change Section -->
                            <div class="accordion-item border-0 mb-3">
                                <h2 class="accordion-header" id="passwordHeading">
                                    <button class="accordion-button bg-dark text-white collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#passwordCollapse"
                                            aria-expanded="false" aria-controls="passwordCollapse">
                                        <i class="bi bi-key me-2"></i>Change Password
                                    </button>
                                </h2>
                                <div id="passwordCollapse" class="accordion-collapse collapse"
                                     aria-labelledby="passwordHeading" data-bs-parent="#securityAccordion">
                                    <div class="accordion-body bg-dark">
                                        <form asp-action="ChangePassword" method="post" class="needs-validation" novalidate>
                                            @Html.AntiForgeryToken()

                                            <div class="form-floating mb-3 position-relative">
                                                <input asp-for="Manage.CurrentPassword" type="password" class="form-control" placeholder=" " required />
                                                <label asp-for="Manage.CurrentPassword">Current Password</label>
                                                <button class="btn btn-link position-absolute end-0 top-0 mt-3 me-2 password-toggle" type="button">
                                                    <i class="bi bi-eye-fill"></i>
                                                </button>
                                                <span asp-validation-for="Manage.CurrentPassword" class="text-danger small"></span>
                                            </div>

                                            <div class="form-floating mb-3 position-relative">
                                                <input asp-for="Manage.NewPassword" type="password" class="form-control" placeholder=" " required />
                                                <label asp-for="Manage.NewPassword">New Password</label>
                                                <button class="btn btn-link position-absolute end-0 top-0 mt-3 me-2 password-toggle" type="button">
                                                    <i class="bi bi-eye-fill"></i>
                                                </button>
                                                <span asp-validation-for="Manage.NewPassword" class="text-danger small"></span>
                                            </div>

                                            <div class="form-floating mb-4 position-relative">
                                                <input asp-for="Manage.ConfirmPassword" type="password" class="form-control" placeholder=" " required />
                                                <label asp-for="Manage.ConfirmPassword">Confirm Password</label>
                                                <button class="btn btn-link position-absolute end-0 top-0 mt-3 me-2 password-toggle" type="button">
                                                    <i class="bi bi-eye-fill"></i>
                                                </button>
                                                <span asp-validation-for="Manage.ConfirmPassword" class="text-danger small"></span>
                                            </div>

                                            <div class="d-grid">
                                                <button type="submit" class="btn btn-accent">
                                                    <span class="submit-text">Update Password</span>
                                                    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Two-Factor Authentication Section -->
                            <div class="accordion-item border-0 mb-3">
                                <h2 class="accordion-header" id="twoFactorHeading">
                                    <button class="accordion-button bg-dark text-white collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#twoFactorCollapse"
                                            aria-expanded="false" aria-controls="twoFactorCollapse">
                                        <i class="bi bi-shield-lock me-2"></i>Two-Factor Authentication
                                    </button>
                                </h2>
                                <div id="twoFactorCollapse" class="accordion-collapse collapse"
                                     aria-labelledby="twoFactorHeading" data-bs-parent="#securityAccordion">
                                    <div class="accordion-body bg-dark">
                                        <form asp-action="ToggleTwoFactor" method="post">
                                            @Html.AntiForgeryToken()

                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="twoFactorSwitch"
                                                @(Model.Profile.TwoFactorEnabled ? "checked" : "")
                                                       onchange="this.form.submit()">
                                                <label class="form-check-label" for="twoFactorSwitch">
                                                    Enable Two-Factor Authentication
                                                </label>
                                            </div>

                                            @if (Model.Profile.TwoFactorEnabled)
                                            {
                                                <div class="alert alert-success mt-3">
                                                    <i class="bi bi-shield-check me-2"></i>
                                                    Two-factor authentication is currently enabled for your account.
                                                </div>
                                            }
                                            else
                                            {
                                                <div class="alert alert-warning mt-3">
                                                    <i class="bi bi-shield-exclamation me-2"></i>
                                                    Two-factor authentication is disabled. We recommend enabling it for added security.
                                                </div>
                                            }

                                            @if (!Model.Profile.EmailVerified || !Model.Profile.PhoneNumberConfirmed)
                                            {
                                                <div class="alert alert-danger mt-3">
                                                    <h6><i class="bi bi-exclamation-triangle me-2"></i>Activation Requirements:</h6>
                                                    <ul class="mb-0">
                                                        @if (!Model.Profile.EmailVerified)
                                                        {
                                                            <li>Email address must be confirmed</li>
                                                        }
                                                        @if (!Model.Profile.PhoneNumberConfirmed)
                                                        {
                                                            <li>Phone number must be verified</li>
                                                        }
                                                    </ul>
                                                </div>
                                            }
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Session Management -->
                            <div class="accordion-item border-0">
                                <h2 class="accordion-header" id="sessionsHeading">
                                    <button class="accordion-button bg-dark text-white collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#sessionsCollapse"
                                            aria-expanded="false" aria-controls="sessionsCollapse">
                                        <i class="bi bi-laptop me-2"></i>Active Sessions
                                    </button>
                                </h2>
                                <div id="sessionsCollapse" class="accordion-collapse collapse"
                                     aria-labelledby="sessionsHeading" data-bs-parent="#securityAccordion">
                                    <div class="accordion-body bg-dark">
                                        <div class="session-item active p-3 rounded mb-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <div class="d-flex align-items-center">
                                                    <i class="bi bi-laptop text-primary me-3 fs-4"></i>
                                                    <div>
                                                        <h6 class="mb-0">Current Session</h6>
                                                        <small class="text-muted">@DateTime.Now.ToString("MMMM dd, yyyy - hh:mm tt")</small>
                                                    </div>
                                                </div>
                                                <span class="badge bg-success">Active</span>
                                            </div>
                                            <div class="session-details ps-5 ms-2">
                                                <p class="small text-muted mb-1">
                                                    <i class="bi bi-geo-alt me-2"></i>
                                                    @(Context.Connection.RemoteIpAddress?.ToString() ?? "Unknown location")
                                                </p>
                                                <p class="small text-muted">
                                                    <i class="bi bi-browser-edge me-2"></i>
                                                    @Context.Request.Headers["User-Agent"]
                                                </p>
                                            </div>
                                        </div>

                                        <div class="text-center mt-3">
                                            <button class="btn btn-outline-danger btn-sm">
                                                <i class="bi bi-box-arrow-right me-2"></i>Sign out all other devices
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
               
                    <!-- Delete Account Tab -->
                <div class="tab-pane fade" id="delete" role="tabpanel" aria-labelledby="delete-tab">
                    <div class="alert alert-danger">
                        <div class="d-flex align-items-start">
                            <i class="bi bi-exclamation-triangle-fill fs-4 me-3"></i>
                            <div>
                                <h5 class="alert-heading mb-2">Danger Zone!</h5>
                                <p class="mb-2">Deleting your account will permanently remove all your data including:</p>
                                <ul class="mb-2">
                                    <li>Your profile information</li>
                                    <li>All your activity history</li>
                                    <li>Any connected services</li>
                                    <li>All your personal data</li>
                                </ul>
                                <p class="mb-0 fw-bold">This action cannot be undone!</p>
                            </div>
                        </div>
                    </div>

                    <form asp-action="DeleteAccount" method="post" class="needs-validation" novalidate>
                        @Html.AntiForgeryToken()

                        <div class="mb-4 p-4 border border-danger rounded">
                                <!-- Password Field -->
                                <div class="form-floating mb-3 position-relative">
                                    <input type="password" class="form-control" asp-for="DeleteAccount.Password" required>
                                    <label asp-for="DeleteAccount.Password">Current Password</label>
                                    <button class="btn btn-link position-absolute end-0 top-0 mt-3 me-2 password-toggle" type="button">
                                        <i class="bi bi-eye-fill"></i>
                                    </button>
                                    <span asp-validation-for="DeleteAccount.Password" class="text-danger small"></span>
                                </div>

                                <!-- Confirmation Checkbox -->
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" asp-for="DeleteAccount.ConfirmDelete" id="confirmDelete" required />
                                    <label class="form-check-label text-light" for="confirmDelete">
                                        I understand that all my data will be permanently deleted
                                    </label>
                                </div>


                                <!-- Confirmation Phrase Textbox -->
                                <div class="form-group mb-3">
                                    <label class="text-light mb-2">Type "DELETE MY ACCOUNT" to confirm:</label>
                                    <input type="text" class="form-control" asp-for="DeleteAccount.DeleteConfirmation" required>
                                    <span asp-validation-for="DeleteAccount.DeleteConfirmation" class="text-danger small"></span>
                                </div>


                        <!-- Submit Button -->
                        <div class="d-grid">
                                    <button type="submit" class="btn btn-danger btn-lg py-3" id="deleteAccountBtn" disabled>
                                        <span class="submit-text">
                                    <i class="bi bi-trash-fill me-2"></i>Permanently Delete My Account
                                </span>
                                <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                            </button>
                        </div>
                    </form>
                </div>
            
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        :root {
            --accent-color: #1cc88a;
            --accent-hover: #17a673;
            --danger-color: #e74a3b;
            --danger-hover: #be2617;
        }

        .auth-card {
            background: rgba(33, 37, 41, 0.95);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 3rem;
        }

        .auth-header {
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1.5rem;
            position: relative;
        }

        .profile-header-image {
            transition: all 0.3s ease;
        }

            .profile-header-image:hover {
                transform: scale(1.05);
            }

            .profile-header-image .btn {
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

        .form-control {
            background-color: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.3s ease;
        }

            .form-control:focus {
                background-color: rgba(255, 255, 255, 0.15);
                border-color: var(--accent-color);
                box-shadow: 0 0 0 0.25rem rgba(28, 200, 138, 0.25);
                color: white;
            }

        .form-floating label {
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
        }

        .form-floating > .form-control:focus ~ label,
        .form-floating > .form-control:not(:placeholder-shown) ~ label {
            color: var(--accent-color);
            opacity: 1;
        }

        .btn-accent {
            background-color: var(--accent-color);
            border: none;
            color: white;
            transition: all 0.3s ease;
            padding: 0.5rem 1.5rem;
            font-weight: 500;
        }

            .btn-accent:hover {
                background-color: var(--accent-hover);
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(28, 200, 138, 0.3);
            }

        .btn-outline-accent {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

            .btn-outline-accent:hover {
                background-color: var(--accent-color);
                color: white;
            }

        .nav-tabs {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

            .nav-tabs .nav-link {
                color: rgba(255, 255, 255, 0.6);
                border: none;
                padding: 0.75rem 1rem;
                font-weight: 500;
                transition: all 0.3s ease;
                position: relative;
            }

                .nav-tabs .nav-link:hover {
                    color: white;
                    border: none;
                }

                .nav-tabs .nav-link.active {
                    color: var(--accent-color);
                    background-color: transparent;
                    border: none;
                }

                    .nav-tabs .nav-link.active::after {
                        content: '';
                        position: absolute;
                        bottom: -1px;
                        left: 0;
                        right: 0;
                        height: 3px;
                        background-color: var(--accent-color);
                        border-radius: 3px 3px 0 0;
                    }

        #deleteAccountBtn {
            transition: all 0.3s ease;
        }

            #deleteAccountBtn:hover {
                background-color: var(--danger-hover);
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(231, 74, 59, 0.3);
            }

        .profile-info-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .info-item {
            padding: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

            .info-item:hover {
                background-color: rgba(255, 255, 255, 0.03);
            }

            .info-item:last-child {
                border-bottom: none;
            }

        .accordion-button {
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
            font-weight: 500;
        }

            .accordion-button:not(.collapsed) {
                background-color: rgba(28, 200, 138, 0.1);
                color: var(--accent-color);
                box-shadow: none;
            }

            .accordion-button::after {
                filter: brightness(0.8);
            }

            .accordion-button:focus {
                box-shadow: none;
                border-color: rgba(28, 200, 138, 0.25);
            }

        .password-toggle {
            color: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }

            .password-toggle:hover {
                color: var(--accent-color);
            }

        .session-item {
            background-color: rgba(255, 255, 255, 0.03);
            border-left: 3px solid var(--accent-color);
        }

            .session-item.active {
                border-left-color: var(--accent-color);
            }

        .notifications-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1100;
            max-width: 350px;
        }

        .alert {
            backdrop-filter: blur(10px);
            border: none;
        }

        .alert-success {
            background-color: rgba(25, 135, 84, 0.9);
            color: white;
        }

        .alert-danger {
            background-color: rgba(220, 53, 69, 0.9);
            color: white;
        }

        .alert-warning {
            background-color: rgba(255, 193, 7, 0.9);
            color: #212529;
        }

        @@media (max-width: 768px) {
            .auth-card {
                padding: 1.5rem;
            }

            .nav-tabs .nav-link {
                padding: 0.5rem;
                font-size: 0.85rem;
            }

            .notifications-container {
                max-width: 100%;
                left: 1rem;
                right: 1rem;
            }
        }
    </style>
}


    @section Scripts {
        @{
            await Html.RenderPartialAsync("_ValidationScriptsPartial");
        }

        <script>
            $(document).ready(function() {
                // Initialize tooltips
                const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });

                // Preview profile image when selected
                $('#profileImageInput').change(function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        if (file.size > 2 * 1024 * 1024) {
                            alert('File size should be less than 2MB');
                            return;
                        }

                        const reader = new FileReader();
                        reader.onload = function(event) {
                            $('#profileImagePreview').attr('src', event.target.result);
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // Toggle password visibility
                $('.password-toggle').click(function() {
                    const input = $(this).closest('.position-relative').find('input');
                    const icon = $(this).find('i');

                    if (input.attr('type') === 'password') {
                        input.attr('type', 'text');
                        icon.removeClass('bi-eye-fill').addClass('bi-eye-slash-fill');
                    } else {
                        input.attr('type', 'password');
                        icon.removeClass('bi-eye-slash-fill').addClass('bi-eye-fill');
                    }
                });

                // Enable/disable delete button based on confirmation
                function validateDelete() {
                    const isConfirmed = $('#confirmDelete').is(':checked');
                    const isTextConfirmed = $('#deleteConfirmation').val() === 'DELETE MY ACCOUNT';
                    $('#deleteAccountBtn').prop('disabled', !(isConfirmed && isTextConfirmed));
                }

                $('#confirmDelete, #deleteConfirmation').on('change keyup', validateDelete);

                // Initialize delete button state
                validateDelete();

                // Form submission loading states
                $('form').submit(function() {
                    const submitBtn = $(this).find('button[type="submit"]');
                    submitBtn.prop('disabled', true);
                    submitBtn.find('.submit-text').addClass('d-none');
                    submitBtn.find('.spinner-border').removeClass('d-none');
                });

                // Tab persistence
                $('button[data-bs-toggle="tab"]').on('click', function(e) {
                    localStorage.setItem('activeTab', $(e.target).attr('data-bs-target'));
                });

                // Restore active tab on page load
                const activeTab = localStorage.getItem('activeTab');
                if (activeTab) {
                    $('.nav-tabs button[data-bs-target="' + activeTab + '"]').tab('show');
                }

                // Auto-focus on first invalid input
                if ($('.is-invalid').length > 0) {
                    $('.is-invalid').first().focus();
                }

            // Two-factor form handling
            $('form').submit(function() {
            const form = $(this);
            if (form.attr('id') === 'toggleTwoFactorForm') {
            const switchBtn = form. find('.form-check-input');
            switchBtn.prop('disabled', true);
            form.find('.btn-submit').html('<span class="spinner-border spinner-border-sm" role="status"></span> Loading...');
            }
            });
            });

                        document.addEventListener("DOMContentLoaded", function () {
                const checkbox = document.getElementById("confirmDelete");
                const textInput = document.querySelector("input[name='DeleteAccount.DeleteConfirmation']");
                const deleteButton = document.getElementById("deleteAccountBtn");

                function toggleButton() {
                    const isChecked = checkbox.checked;
                    const textConfirmed = textInput.value.trim().toUpperCase() === "DELETE MY ACCOUNT";

                    deleteButton.disabled = !(isChecked && textConfirmed);
                }

                checkbox.addEventListener("change", toggleButton);
                textInput.addEventListener("input", toggleButton);
            });

        </script>
    }
